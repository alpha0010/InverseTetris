(function(){function p(c,a){return function(){return c.apply(a,arguments)}}var l;l=function(){function c(a){this.I=p(this.I,this);this.J=p(this.J,this);this.u=p(this.u,this);this.A=p(this.A,this);var b,d=this;b=Math.min(((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-20)/(this.i+this.w)-1,((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-20)/(this.n+this.D)-1);this.b=b>this.b?Math.floor((b+this.b)/2):Math.floor(b);b=document.getElementById("gameBoard"); b.width=(this.b+1)*(this.i+this.w)+1;b.height=(this.b+1)*(this.n+this.D)+1;this.a=b.getContext("2d");this.aa();this.$();this.ba();this.K=b.getBoundingClientRect();b.addEventListener("mousemove",function(a){return d.J(a)});b.addEventListener("mouseup",function(a){return d.I(a)});this.P=a;this.A()}c.prototype.j=null;c.prototype.b=25;c.prototype.n=20;c.prototype.i=10;c.prototype.w=5;c.prototype.D=4;c.prototype.B=175;c.prototype.Q=15;c.prototype.a=null;c.prototype.q=null;c.prototype.c=null;c.prototype.p= null;c.prototype.l=null;c.prototype.P=null;c.prototype.M=0;c.prototype.r=0;c.prototype.K=null;c.prototype.m=-1;c.prototype.g=null;c.prototype.aa=function(){this.q=[[[0,255,255],2,[1,1,1,1]],[[0,0,255],4,[1,1,1],[0,0,1]],[[255,165,0],4,[1,1,1],[1,0,0]],[[255,255,0],1,[1,1],[1,1]],[[128,255,0],2,[0,1,1],[1,1,0]],[[128,0,128],4,[1,1,1],[0,1,0]],[[255,0,255],2,[1,1,0],[0,1,1]]]};c.prototype.$=function(){var a,b,d,e,c,g,f;this.j=[];d=e=0;for(g=this.n;0<=g?e<g:e>g;d=0<=g?++e:--e)for(this.j[d]=[],b=c=0, f=this.i;0<=f?c<f:c>f;b=0<=f?++c:--c)a={h:!1,fillStyle:null},this.j[d][b]=a};c.prototype.ba=function(){var a,b,d,e;this.g=[];a=this.b/2;b=d=0;for(e=this.q.length;0<=e?d<e:d>e;b=0<=e?++d:--d)this.g.push({x:(1+b%4*5)*(a+1)+1,y:(2*this.n+(3<b?3:0))*(a+1)+1,count:4})};c.prototype.o=function(a){var b,d,e,c,g,f,k;d=[];e=c=0;for(f=a.length;0<=f?c<f:c>f;e=0<=f?++c:--c)for(b=g=0,k=a[e].length;0<=k?g<k:g>k;b=0<=k?++g:--g)0===e&&(d[b]=[]),d[b][e]=a[a.length-e-1][b];return d};c.prototype.A=function(){var a,b, d,e,c,g,f,k;if(null===this.c){null===this.p&&(this.l=Math.floor(7*Math.random()),this.p=this.G(this.q[this.l]));this.c=this.p;this.g[this.l].count-=1;a=b=!0;g=this.g;e=0;for(c=g.length;e<c;e++)d=g[e],1<d.count&&(b=!1),d.count!==this.g[this.l].count&&(a=!1);if(a)for(e=this.g,a=0,b=e.length;a<b;a++)d=e[a],d.count=4;else if(b)for(e=this.g,a=0,b=e.length;a<b;a++)d=e[a],d.count+=2;-1!==this.m&&0>=this.g[this.m].count&&(this.m=-1);for(this.l=0;0>=this.g[this.l].count;)this.l=(this.l+1)%7;this.p=this.G(this.q[this.l]); this.R();this.H();this.B=175}if(this.k(this.c.f+1,this.c.e)){if(-1===this.c.f)return;this.U();this.c=null;a=0;k=this.j;e=0;for(c=k.length;e<c;e++)for(b=k[e],f=0,g=b.length;f<g;f++)d=b[f],d.h&&(a+=1);this.r+=1;this.M+=Math.floor(4*Math.pow(a,0.6))/4}else this.c.f+=1;this.s();setTimeout(this.A,this.B);return setTimeout(this.u,this.Q)};c.prototype.u=function(){var a;if(null!==this.c){a=this.P.W(this.j,this.c);switch(a){case 1:this.ca();break;case 2:this.da();break;case 3:this.ea();break;case 4:this.fa(); break;default:this.B=Math.max(64,175-this.r);return}this.B=175;return setTimeout(this.u,this.Q)}};c.prototype.J=function(a){var b,d,e,c,g;d=a.clientX-this.K.left;e=a.clientY-this.K.top;a=c=0;for(g=this.g.length;0<=g?c<g:c>g;a=0<=g?++c:--c)if(b=this.g[a],d>b.x&&d<b.x+2*this.b&&e>b.y&&e<b.y+this.b){0>=this.g[a].count&&(a=-1);this.m!==a&&(this.m=a,this.H());return}-1!==this.m&&(this.m=-1,this.H())};c.prototype.I=function(){-1!==this.m&&(this.p=this.G(this.q[this.m]),this.l=this.m,this.R())};c.prototype.k= function(a,b){var d,e,c,g,f,k;e=c=0;for(f=this.c.d.length;0<=f?c<f:c>f;e=0<=f?++c:--c){if(0>a+e||a+e>=this.n)return!0;d=g=0;for(k=this.c.d[e].length;0<=k?g<k:g>k;d=0<=k?++g:--g)if(0>b+d||b+d>=this.i||1===this.c.d[e][d]&&this.j[a+e][b+d].h)return!0}return!1};c.prototype.G=function(a){return{f:-1,e:Math.floor((this.i-a[2].length)/2),fillStyle:"rgb("+a[0][0]+","+a[0][1]+","+a[0][2]+")",S:a[1],d:a.slice(2)}};c.prototype.U=function(){var a,b,d,e,c,g,f;d=this.c.d;b=e=0;for(g=d.length;0<=g?e<g:e>g;b=0<= g?++e:--e)for(a=c=0,f=d[b].length;0<=f?c<f:c>f;a=0<=f?++c:--c)1===d[b][a]&&(a=this.j[b+this.c.f][a+this.c.e],a.h=!0,a.fillStyle=this.c.fillStyle);this.F()};c.prototype.F=function(){var a,b,d;a=b=0;for(d=this.n;0<=d?b<d:b>d;a=0<=d?++b:--b)this.C(this.j[a])&&this.L(a)};c.prototype.C=function(a){var b,d,e;d=0;for(e=a.length;d<e;d++)if(b=a[d],!b.h)return!1;return!0};c.prototype.L=function(a){var b,d;this.j.splice(a,1);this.j.splice(0,0,[]);a=b=0;for(d=this.i;0<=d?b<d:b>d;a=0<=d?++b:--b)this.j[0][a]={h:!1, fillStyle:null}};c.prototype.s=function(){var a,b,d,e,c,g,f,k;b=d=0;for(c=this.n;0<=c?d<c:d>c;b=0<=c?++d:--d)for(a=e=0,g=this.i;0<=g?e<g:e>g;a=0<=g?++e:--e)this.v(this.j[b][a],b,a);if(null!==this.c)for(a={h:!1,fillStyle:null,h:!0},a.fillStyle=this.c.fillStyle,b=this.c.d,e=c=0,f=b.length;0<=f?c<f:c>f;e=0<=f?++c:--c)for(d=g=0,k=b[e].length;0<=k?g<k:g>k;d=0<=k?++g:--g)1===b[e][d]&&this.v(a,this.c.f+e,this.c.e+d)};c.prototype.R=function(){var a,b,d,c,h,g,f,k;this.a.fillStyle="rgb(38,38,38)";this.a.strokeStyle= "transparent";this.a.fillRect(this.i*(this.b+1)+1,0,this.w*(this.b+1),this.n*(this.b+1));a={h:!1,fillStyle:null,h:!0};a.fillStyle=this.p.fillStyle;b=this.p.d;c=h=0;for(f=b.length;0<=f?h<f:h>f;c=0<=f?++h:--h)for(d=g=0,k=b[c].length;0<=k?g<k:g>k;d=0<=k?++g:--g)1===b[c][d]&&this.v(a,1+c,this.i+1+d);this.Z()};c.prototype.H=function(){var a,b,d,c,h,g,f,k,l,m,n,p,q;this.a.fillStyle="rgb(38,38,38)";this.a.strokeStyle="transparent";this.a.fillRect(0,this.n*(this.b+1)+1,(this.i+this.w)*(this.b+1),this.D*(this.b+ 1));d=this.b;this.b/=2;c=k=0;for(n=this.q.length;0<=n?k<n:k>n;c=0<=n?++k:--k){a=this.q[c];b={h:!1,fillStyle:null,h:!0};b.fillStyle=0<this.g[c].count?"rgb("+a[0][0]+","+a[0][1]+","+a[0][2]+")":"gray";f="transparent";c===this.m&&(f="red");a=a.slice(2);g=l=0;for(p=a.length;0<=p?l<p:l>p;g=0<=p?++l:--l)for(h=m=0,q=a[g].length;0<=q?m<q:m>q;h=0<=q?++m:--m)1===a[g][h]&&this.v(b,2*this.n+g+(3<c?3:0),1+h+c%4*5,f);this.a.font=""+this.b+"px Arial";this.a.fillStyle="white";this.a.fillText(this.g[c].count,this.g[c].x, this.g[c].y-1)}this.b=d};c.prototype.Z=function(){this.a.font=""+this.b+"px Arial";this.a.fillStyle="white";this.a.fillText("Score",(this.i+0.5)*(this.b+1),5*(this.b+1));0<this.r&&this.a.fillText(Math.round(1E3*this.M/this.r),(this.i+0.5)*(this.b+1),6*(this.b+1));this.a.fillText("Blocks",(this.i+0.5)*(this.b+1),7.4*(this.b+1));this.a.fillText(this.r,(this.i+0.5)*(this.b+1),8.4*(this.b+1))};c.prototype.v=function(a,b,d,c){var h;null==c&&(c="rgb(54,51,40)");d=d*(this.b+1)+1;b=b*(this.b+1)+1;h=a.h?a.fillStyle: "rgb(38,38,38)";this.a.strokeStyle=c;this.a.strokeRect(d,b,this.b,this.b);this.a.fillStyle=h;this.a.fillRect(d,b,this.b,this.b);a.h&&(a=this.b/4,this.a.beginPath(),this.a.moveTo(d,b+this.b),this.a.lineTo(d+this.b,b+this.b),this.a.lineTo(d+this.b-a,b+this.b-a),this.a.lineTo(d+a,b+this.b-a),this.a.closePath(),c=this.a.createLinearGradient(d,b+this.b-a,d,b+this.b),c.addColorStop(0,"rgba(0,0,0,0)"),c.addColorStop(1,"rgba(0,0,0,0.5)"),this.a.fillStyle=c,this.a.fill(),this.a.beginPath(),this.a.moveTo(d+ this.b,b),this.a.lineTo(d+this.b,b+this.b),this.a.lineTo(d+this.b-a,b+this.b-a),this.a.lineTo(d+this.b-a,b+a),this.a.closePath(),c=this.a.createLinearGradient(d+this.b-a,b,d+this.b,b),c.addColorStop(0,"rgba(0,0,0,0)"),c.addColorStop(1,"rgba(0,0,0,0.5)"),this.a.fillStyle=c,this.a.fill(),this.a.beginPath(),this.a.moveTo(d,b),this.a.lineTo(d+this.b,b),this.a.lineTo(d+this.b-a,b+a),this.a.lineTo(d+a,b+a),this.a.closePath(),c=this.a.createLinearGradient(d,b+a,d,b),c.addColorStop(0,"rgba(255,255,255,0)"), c.addColorStop(1,"rgba(255,255,255,0.4)"),this.a.fillStyle=c,this.a.fill(),this.a.beginPath(),this.a.moveTo(d,b),this.a.lineTo(d,b+this.b),this.a.lineTo(d+a,b+this.b-a),this.a.lineTo(d+a,b+a),this.a.closePath(),c=this.a.createLinearGradient(d+a,b,d,b),c.addColorStop(0,"rgba(255,255,255,0)"),c.addColorStop(1,"rgba(255,255,255,0.4)"),this.a.fillStyle=c,this.a.fill(),a=this.b/6,this.a.beginPath(),this.a.moveTo(d+a,b),this.a.quadraticCurveTo(d,b,d,b+a),this.a.lineTo(d,b),this.a.closePath(),this.a.fillStyle= "rgb(38,38,38)",this.a.fill(),this.a.beginPath(),this.a.moveTo(d+this.b-a,b),this.a.quadraticCurveTo(d+this.b,b,d+this.b,b+a),this.a.lineTo(d+this.b,b),this.a.closePath(),this.a.fill(),this.a.beginPath(),this.a.moveTo(d,b+this.b-a),this.a.quadraticCurveTo(d,b+this.b,d+a,b+this.b),this.a.lineTo(d,b+this.b),this.a.closePath(),this.a.fill(),this.a.beginPath(),this.a.moveTo(d+this.b,b+this.b-a),this.a.quadraticCurveTo(d+this.b,b+this.b,d+this.b-a,b+this.b),this.a.lineTo(d+this.b,b+this.b),this.a.closePath(), this.a.fill())};c.prototype.ca=function(){null===this.c||this.k(this.c.f,this.c.e-1)||(this.c.e-=1,this.s())};c.prototype.da=function(){null===this.c||this.k(this.c.f,this.c.e+1)||(this.c.e+=1,this.s())};c.prototype.ea=function(){var a;null!==this.c&&(a=this.c.d,this.c.d=this.o(this.o(this.o(this.c.d))),this.k(this.c.f,this.c.e)?this.c.d=a:this.s())};c.prototype.fa=function(){var a;null!==this.c&&(a=this.c.d,this.c.d=this.o(this.c.d),this.k(this.c.f,this.c.e)?this.c.d=a:this.s())};return c}();window.InverseTetris= l}).call(this);
