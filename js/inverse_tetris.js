(function(){function n(b,a){return function(){return b.apply(a,arguments)}}var l;l=function(){function b(a){this.M=n(this.M,this);this.N=n(this.N,this);this.O=n(this.O,this);this.v=n(this.v,this);this.B=n(this.B,this);var e,c,d,h,b,g=this;e=Math.min(((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-20)/(this.j+this.R)-1,((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-20)/(this.p+this.G)-1);this.b=e>this.b?Math.floor((e+this.b)/ 2):Math.floor(e);e=document.getElementById("gameBoard");e.width=(this.b+1)*(this.j+this.R)+1;e.height=(this.b+1)*(this.p+this.G)+1;this.a=e.getContext("2d");this.a.fillStyle="rgb(38,38,38)";this.a.strokeStyle="transparent";this.a.fillRect(0,0,e.width,e.height);this.ha();this.ga();this.i=Math.floor(7*Math.random());this.o=this.r(this.h[this.i]);this.ia();this.P=e.getBoundingClientRect();e.addEventListener("mousemove",function(a){return g.O(a)});e.addEventListener("mouseup",function(a){return g.N(a)}); window.addEventListener("keypress",function(a){return g.M(a)});e=[];b=this.h;d=0;for(h=b.length;d<h;d++)c=b[d],e.push(this.r(c));a.fa(e);this.D=a;this.B()}b.prototype.l=null;b.prototype.b=25;b.prototype.p=20;b.prototype.j=10;b.prototype.R=5;b.prototype.G=4;b.prototype.C=175;b.prototype.V=15;b.prototype.a=null;b.prototype.h=null;b.prototype.c=null;b.prototype.o=null;b.prototype.i=null;b.prototype.D=null;b.prototype.S=0;b.prototype.s=0;b.prototype.P=null;b.prototype.n=-1;b.prototype.f=null;b.prototype.ha= function(){this.h=[[[0,255,255],2,[1,1,1,1]],[[0,0,255],4,[1,1,1],[0,0,1]],[[255,165,0],4,[1,1,1],[1,0,0]],[[255,255,0],1,[1,1],[1,1]],[[128,255,0],2,[0,1,1],[1,1,0]],[[128,0,128],4,[1,1,1],[0,1,0]],[[255,0,255],2,[1,1,0],[0,1,1]]];this.h.X="ijlostz"};b.prototype.ga=function(){var a,e,c,d,b,f,g;this.l=[];c=d=0;for(f=this.p;0<=f?d<f:d>f;c=0<=f?++d:--d)for(this.l[c]=[],e=b=0,g=this.j;0<=g?b<g:b>g;e=0<=g?++b:--b)a={k:!1,fillStyle:null},this.l[c][e]=a};b.prototype.ia=function(){var a,e,c,d;this.f=[]; a=this.b/2;e=c=0;for(d=this.h.length;0<=d?c<d:c>d;e=0<=d?++c:--c)this.f.push({x:(1+e%4*5)*(a+1)+1,y:(2*this.p+(3<e?3:0))*(a+1)+1,count:4})};b.prototype.q=function(a){var e,c,d,b,f,g,k;c=[];d=b=0;for(g=a.length;0<=g?b<g:b>g;d=0<=g?++b:--b)for(e=f=0,k=a[d].length;0<=k?f<k:f>k;e=0<=k?++f:--f)0===d&&(c[e]=[]),c[e][d]=a[a.length-d-1][e];return c};b.prototype.B=function(){var a,e,c,d,b,f,g,k;if(null===this.c){if(null===this.o){if(0.7>Math.random())for(a=Number.MAX_VALUE,c=d=0,b=this.f.length;0<=b?d<b:d> b;c=0<=b?++d:--d)0<this.f[c].count&&(e=this.D.la(this.l,this.r(this.h[c])),e<a&&(a=e,this.i=c));else for(this.i=Math.floor(7*Math.random());0===this.f[this.i].count;)this.i=(this.i+1)%7;this.o=this.r(this.h[this.i])}this.c=this.o;this.f[this.i].count-=1;a=e=!0;f=this.f;d=0;for(b=f.length;d<b;d++)c=f[d],1<c.count&&(e=!1),c.count!==this.f[this.i].count&&(a=!1);if(a)for(d=this.f,a=0,e=d.length;a<e;a++)c=d[a],c.count=4;else if(e)for(d=this.f,a=0,e=d.length;a<e;a++)c=d[a],c.count+=2;-1!==this.n&&0>=this.f[this.n].count&& (this.n=-1);this.i=-1;this.o=null;this.J();this.K();this.C=175}if(this.m(this.c.g+1,this.c.e)){if(-1===this.c.g)return;this.aa();this.c=null;a=0;k=this.l;f=0;for(d=k.length;f<d;f++)for(e=k[f],g=0,b=e.length;g<b;g++)c=e[g],c.k&&(a+=1);this.s+=1;this.S+=Math.floor(4*Math.pow(a,0.6))/4}else this.c.g+=1;this.t();setTimeout(this.B,this.C);return setTimeout(this.v,this.V)};b.prototype.v=function(){var a;if(null!==this.c){a=this.D.ca(this.l,this.c);switch(a){case 1:this.ja();break;case 2:this.ka();break; case 3:this.ma();break;case 4:this.na();break;default:this.C=Math.max(64,175-this.s);return}this.C=175;return setTimeout(this.v,this.V)}};b.prototype.O=function(a){var e,c,d,b,f;c=a.clientX-this.P.left;d=a.clientY-this.P.top;a=b=0;for(f=this.f.length;0<=f?b<f:b>f;a=0<=f?++b:--b)if(e=this.f[a],c>e.x&&c<e.x+2*this.b&&d>e.y&&d<e.y+this.b){0>=this.f[a].count&&(a=-1);this.n!==a&&(this.n=a,this.K());return}-1!==this.n&&(this.n=-1,this.K())};b.prototype.N=function(){-1!==this.n&&(this.o=this.r(this.h[this.n]), this.i=this.n,this.J())};b.prototype.M=function(a){var e;e=null;null===a.which?e=String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode&&(e=String.fromCharCode(a.which));null!==e&&(a=this.h.X.search(e),-1!==a&&0<this.f[a].count&&a!==this.i&&(this.o=this.r(this.h[a]),this.i=a,this.J()))};b.prototype.m=function(a,e){var c,d,b,f,g,k;d=b=0;for(g=this.c.d.length;0<=g?b<g:b>g;d=0<=g?++b:--b){if(0>a+d||a+d>=this.p)return!0;c=f=0;for(k=this.c.d[d].length;0<=k?f<k:f>k;c=0<=k?++f:--f)if(0>e+c||e+c>=this.j|| 1===this.c.d[d][c]&&this.l[a+d][e+c].k)return!0}return!1};b.prototype.r=function(a){return{g:-1,e:Math.floor((this.j-a[2].length)/2),fillStyle:"rgb("+a[0][0]+","+a[0][1]+","+a[0][2]+")",Y:a[1],d:a.slice(2)}};b.prototype.aa=function(){var a,e,c,d,b,f,g;c=this.c.d;e=d=0;for(f=c.length;0<=f?d<f:d>f;e=0<=f?++d:--d)for(a=b=0,g=c[e].length;0<=g?b<g:b>g;a=0<=g?++b:--b)1===c[e][a]&&(a=this.l[e+this.c.g][a+this.c.e],a.k=!0,a.fillStyle=this.c.fillStyle);this.I()};b.prototype.I=function(){var a,e,c;a=e=0;for(c= this.p;0<=c?e<c:e>c;a=0<=c?++e:--e)this.F(this.l[a])&&this.Q(a)};b.prototype.F=function(a){var e,c,d;c=0;for(d=a.length;c<d;c++)if(e=a[c],!e.k)return!1;return!0};b.prototype.Q=function(a){var e,c;this.l.splice(a,1);this.l.splice(0,0,[]);a=e=0;for(c=this.j;0<=c?e<c:e>c;a=0<=c?++e:--e)this.l[0][a]={k:!1,fillStyle:null}};b.prototype.t=function(){var a,e,c,d,b,f,g,k;e=c=0;for(b=this.p;0<=b?c<b:c>b;e=0<=b?++c:--c)for(a=d=0,f=this.j;0<=f?d<f:d>f;a=0<=f?++d:--d)this.w(this.l[e][a],e,a);if(null!==this.c)for(a= {k:!1,fillStyle:null,k:!0},a.fillStyle=this.c.fillStyle,e=this.c.d,d=b=0,g=e.length;0<=g?b<g:b>g;d=0<=g?++b:--b)for(c=f=0,k=e[d].length;0<=k?f<k:f>k;c=0<=k?++f:--f)1===e[d][c]&&this.w(a,this.c.g+d,this.c.e+c)};b.prototype.J=function(){var a,e,c,b,h,f,g,k;this.a.fillStyle="rgb(38,38,38)";this.a.strokeStyle="transparent";this.a.fillRect(this.j*(this.b+1)+1,0,this.R*(this.b+1),this.p*(this.b+1));this.ea();if(null===this.o)this.a.font=""+this.b+"px Arial",this.a.fillStyle="white",this.a.fillText("???", (this.j+1.25)*(this.b+1),2.25*(this.b+1));else for(a={k:!1,fillStyle:null,k:!0},a.fillStyle=this.o.fillStyle,e=this.o.d,b=h=0,g=e.length;0<=g?h<g:h>g;b=0<=g?++h:--h)for(c=f=0,k=e[b].length;0<=k?f<k:f>k;c=0<=k?++f:--f)1===e[b][c]&&this.w(a,1+b,this.j+1+c)};b.prototype.K=function(){var a,e,c,b,h,f,g,k,l,p,m,n,r;this.a.fillStyle="rgb(38,38,38)";this.a.strokeStyle="transparent";this.a.fillRect(0,this.p*(this.b+1)+1,this.j*(this.b+1),this.G*(this.b+1));c=this.b;this.b/=2;b=k=0;for(m=this.h.length;0<=m? k<m:k>m;b=0<=m?++k:--k){a=this.h[b];e={k:!1,fillStyle:null,k:!0};e.fillStyle=0<this.f[b].count?"rgb("+a[0][0]+","+a[0][1]+","+a[0][2]+")":"gray";g="transparent";b===this.n&&(g="red");a=a.slice(2);f=l=0;for(n=a.length;0<=n?l<n:l>n;f=0<=n?++l:--l)for(h=p=0,r=a[f].length;0<=r?p<r:p>r;h=0<=r?++p:--p)1===a[f][h]&&this.w(e,2*this.p+f+(3<b?3:0),1+h+b%4*5,g);this.a.font=""+this.b+"px Arial";this.a.fillStyle="white";this.a.fillText(this.f[b].count,this.f[b].x,this.f[b].y-1);this.a.font=""+0.9*this.b+"px Arial"; this.a.fillStyle="grey";this.a.fillText("("+this.h.X[b].toUpperCase()+")",this.f[b].x+this.b,this.f[b].y-this.b/5)}this.b=c};b.prototype.ea=function(){this.a.font=""+this.b+"px Arial";this.a.fillStyle="white";this.a.fillText("Score",(this.j+0.5)*(this.b+1),5*(this.b+1));0<this.s&&this.a.fillText(Math.round(1E3*this.S/this.s),(this.j+0.5)*(this.b+1),6*(this.b+1));this.a.fillText("Blocks",(this.j+0.5)*(this.b+1),7.4*(this.b+1));this.a.fillText(this.s,(this.j+0.5)*(this.b+1),8.4*(this.b+1))};b.prototype.w= function(a,b,c,d){var h;null==d&&(d="rgb(54,51,40)");c=c*(this.b+1)+1;b=b*(this.b+1)+1;h=a.k?a.fillStyle:"rgb(38,38,38)";this.a.strokeStyle=d;this.a.strokeRect(c,b,this.b,this.b);this.a.fillStyle=h;this.a.fillRect(c,b,this.b,this.b);a.k&&(a=this.b/4,this.a.beginPath(),this.a.moveTo(c,b+this.b),this.a.lineTo(c+this.b,b+this.b),this.a.lineTo(c+this.b-a,b+this.b-a),this.a.lineTo(c+a,b+this.b-a),this.a.closePath(),d=this.a.createLinearGradient(c,b+this.b-a,c,b+this.b),d.addColorStop(0,"rgba(0,0,0,0)"), d.addColorStop(1,"rgba(0,0,0,0.5)"),this.a.fillStyle=d,this.a.fill(),this.a.beginPath(),this.a.moveTo(c+this.b,b),this.a.lineTo(c+this.b,b+this.b),this.a.lineTo(c+this.b-a,b+this.b-a),this.a.lineTo(c+this.b-a,b+a),this.a.closePath(),d=this.a.createLinearGradient(c+this.b-a,b,c+this.b,b),d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,0.5)"),this.a.fillStyle=d,this.a.fill(),this.a.beginPath(),this.a.moveTo(c,b),this.a.lineTo(c+this.b,b),this.a.lineTo(c+this.b-a,b+a),this.a.lineTo(c+ a,b+a),this.a.closePath(),d=this.a.createLinearGradient(c,b+a,c,b),d.addColorStop(0,"rgba(255,255,255,0)"),d.addColorStop(1,"rgba(255,255,255,0.4)"),this.a.fillStyle=d,this.a.fill(),this.a.beginPath(),this.a.moveTo(c,b),this.a.lineTo(c,b+this.b),this.a.lineTo(c+a,b+this.b-a),this.a.lineTo(c+a,b+a),this.a.closePath(),d=this.a.createLinearGradient(c+a,b,c,b),d.addColorStop(0,"rgba(255,255,255,0)"),d.addColorStop(1,"rgba(255,255,255,0.4)"),this.a.fillStyle=d,this.a.fill(),a=this.b/6,this.a.beginPath(), this.a.moveTo(c+a,b),this.a.quadraticCurveTo(c,b,c,b+a),this.a.lineTo(c,b),this.a.closePath(),this.a.fillStyle="rgb(38,38,38)",this.a.fill(),this.a.beginPath(),this.a.moveTo(c+this.b-a,b),this.a.quadraticCurveTo(c+this.b,b,c+this.b,b+a),this.a.lineTo(c+this.b,b),this.a.closePath(),this.a.fill(),this.a.beginPath(),this.a.moveTo(c,b+this.b-a),this.a.quadraticCurveTo(c,b+this.b,c+a,b+this.b),this.a.lineTo(c,b+this.b),this.a.closePath(),this.a.fill(),this.a.beginPath(),this.a.moveTo(c+this.b,b+this.b- a),this.a.quadraticCurveTo(c+this.b,b+this.b,c+this.b-a,b+this.b),this.a.lineTo(c+this.b,b+this.b),this.a.closePath(),this.a.fill())};b.prototype.ja=function(){null===this.c||this.m(this.c.g,this.c.e-1)||(this.c.e-=1,this.t())};b.prototype.ka=function(){null===this.c||this.m(this.c.g,this.c.e+1)||(this.c.e+=1,this.t())};b.prototype.ma=function(){var a;null!==this.c&&(a=this.c.d,this.c.d=this.q(this.q(this.q(this.c.d))),this.m(this.c.g,this.c.e)?this.c.d=a:this.t())};b.prototype.na=function(){var a; null!==this.c&&(a=this.c.d,this.c.d=this.q(this.c.d),this.m(this.c.g,this.c.e)?this.c.d=a:this.t())};return b}();window.InverseTetris=l}).call(this);
